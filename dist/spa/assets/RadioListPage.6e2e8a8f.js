import{Q as L}from"./QPage.82e76fcb.js";import{r as i,d as F,_ as V,o as s,c as b,w as r,e as w,b as p,ac as T,ad as h,ae as N,aa as y,ab as g,f as k,ag as _,af as A,g as U,ah as q,a as H}from"./index.14a7c722.js";import{u as R,Q as I}from"./use-quasar.7a6bd282.js";import{Q as P}from"./QSelect.c55664e6.js";import{Q as S}from"./QField.3dd07fc9.js";import{a as C,Q,b as D,c as z}from"./QTable.8542a644.js";import{A as j,d as G}from"./BaseApi.ab9ec937.js";import"./QDialog.946db96e.js";import"./use-prevent-scroll.49273e16.js";import"./use-tick.7b8fea28.js";import"./focus-manager.02955f48.js";import"./QChip.15935488.js";import"./use-dark.7ce8ffd6.js";import"./QItem.0cb08ef4.js";import"./QItemLabel.d7165eea.js";import"./position-engine.ef89f240.js";import"./format.2a3572e1.js";import"./QSeparator.2e92d9dc.js";import"./QList.0b3bac39.js";import"./QCheckbox.9468544f.js";import"./use-checkbox.812d2cd3.js";class M extends j{search(){const t="/radio/search",d=this.combineUrl(t);return this.httpGet(d)}async download(t){const d=`/radio/download?id=${t}`,m=this.combineUrl(d);await G({url:m,method:"GET",responseType:"blob"}).then(u=>{if(u)return console.log("download",u),u})}}const $=new M;function O(){const e=R(),t=i({text:"",date:""}),d=i(""),m=i(-1),u=[{name:"displayName",label:"\u30BF\u30A4\u30C8\u30EB",field:"displayName",sortable:!0},{name:"date",label:"\u65E5\u6642",field:"date",sortable:!0},{name:"fileName",label:"\u30D5\u30A1\u30A4\u30EB\u540D",field:"fileName",sortable:!0}],c=i({search:!1,download:!1}),a=i([]),l=i([]);return{filter:t,columns:u,load:c,records:a,search:async function(){c.value.search=!0,await $.search().then(f=>{if(f){console.log("search",f),a.value.splice(0),l.value.splice(0);const n=[];f.records.forEach(o=>{l.value.includes(o.date.split(" ")[0])||(l.value.push(o.date.split(" ")[0]),n.push(o.date.split(" ")[0]));const v={id:o.id,fileName:o.fileName,displayName:"",date:o.date};a.value.push(v)}),a.value.sort((o,v)=>o.date>v.date?-1:1),n.reverse(),a.value.forEach(o=>{const v=`\u7B2C${n.indexOf(o.date.split(" ")[0])+1}\u56DE`;o.displayName=v})}}).catch(f=>{console.log(f),e.notify({color:"red",position:"top",message:"\u30C7\u30FC\u30BF\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F"})}),c.value.search=!1},selectId:m,dateList:l,dateFilter:d,filteringData:function(f){let n=f;return t.value.text!=""&&(n=n.filter(o=>o.displayName.includes(t.value.text)||o.fileName.includes(t.value.text))),t.value.date!=""&&t.value.date!=null&&(n=n.filter(o=>o.date.includes(t.value.date))),n}}}const x=F({name:"table-karaoke-list",props:{label:{type:String,required:!1,default:"\u30AA\u30E0\u5B50\u30EC\u30A4\u30C7\u30A3\u30AA"},height:{type:Number,required:!1,default:700}},setup(e){const{columns:t,load:d,records:m,search:u,selectId:c,dateList:a,filter:l,dateFilter:B,filteringData:E}=O();return u(),{tableName:i(e.label),tableHeight:i(e.height+"px"),columns:t,load:d,records:m,search:u,api:$,selectId:c,playUrl:i(""),playName:i(""),dateList:a,filter:l,dateFilter:B,filteringData:E}}}),J={class:"row q-gutter-md",style:{width:"700px"}},K={key:3,class:"text-caption"},W={key:0,class:"row q-gutter-md"},X=["src"],Y={key:0,style:{width:"70px"}},Z={key:1,style:{width:"150px"}},ee={key:2},ae=["href","onClick"];function te(e,t,d,m,u,c){return e.load.search?h("",!0):(s(),b(z,{key:0,title:e.tableName,rows:e.records,columns:e.columns,"row-key":"id",style:q({height:e.tableHeight}),separator:"cell","rows-per-page-label":"\u8868\u793A\u884C\u6570","no-results-label":"\u898B\u3064\u304B\u3089\u306A\u304B\u3063\u305F...","no-data-label":"\u898B\u3064\u304B\u3089\u306A\u304B\u3063\u305F...",pagination:{rowsPerPage:0},"rows-per-page-options":[0],filter:e.filter,"filter-method":e.filteringData,class:"radio-list-table"},{"top-right":r(()=>[w("div",J,[w("div",null,[p(I,{dense:"",debounce:"300",modelValue:e.filter.text,"onUpdate:modelValue":t[1]||(t[1]=a=>e.filter.text=a),placeholder:"\u691C\u7D22",style:{width:"200px"},align:"left"},{append:r(()=>[e.load.search?(s(),b(T,{key:0,modelValue:e.load.search,"onUpdate:modelValue":t[0]||(t[0]=a=>e.load.search=a),color:"primary",size:"md"},null,8,["modelValue"])):h("",!0),e.filter.text.length==0?(s(),b(N,{key:1,name:"search"})):(s(),b(N,{key:2,name:"search",color:"primary"})),e.records.length>0?(s(),y("div",K,g(e.records.length),1)):h("",!0)]),_:1},8,["modelValue"])]),w("div",null,[p(P,{modelValue:e.filter.date,"onUpdate:modelValue":t[2]||(t[2]=a=>e.filter.date=a),options:e.dateList,dense:"","stack-label":"",label:"\u65E5\u4ED8","transition-show":"jump-up","transition-hide":"jump-up",style:{width:"150px"},clearable:""},null,8,["modelValue","options"])])]),e.playName!=""&&e.playUrl!=""?(s(),y("div",W,[w("audio",{controls:"",src:e.playUrl,autoplay:""},null,8,X),p(S,{borderless:"",class:"q-pt-md",style:{height:"18px"}},{default:r(()=>[k(g(e.playName),1)]),_:1})])):h("",!0)]),header:r(a=>[p(Q,{props:a},{default:r(()=>[p(C,{style:{width:"50px"}},{default:r(()=>[k("\u518D\u751F")]),_:1}),(s(!0),y(A,null,_(a.cols,l=>(s(),b(C,{key:l.name,props:a},{default:r(()=>[l.label=="\u30BF\u30A4\u30C8\u30EB"?(s(),y("div",Y,g(l.label),1)):h("",!0),l.label=="\u65E5\u6642"?(s(),y("div",Z,g(l.label),1)):h("",!0),l.label=="\u30D5\u30A1\u30A4\u30EB\u540D"?(s(),y("div",ee,g(l.label),1)):h("",!0)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:r(a=>[p(Q,{props:a},{default:r(()=>[p(D,null,{default:r(()=>[w("a",{href:e.api.apiEndpoint()+"/radio/download?id="+a.row.id,onClick:U(l=>{console.log("play",a.row),e.playUrl=e.api.apiEndpoint()+"/radio/download?id="+a.row.id,e.playName=a.row.fileName},["prevent"]),class:"play-btn"},[p(N,{name:"play_circle",color:"primary",size:"sm"})],8,ae)]),_:2},1024),(s(!0),y(A,null,_(a.cols,l=>(s(),b(D,{key:l.name,props:a,style:{"white-space":"normal","text-align":"left"}},{default:r(()=>[k(g(l.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),_:1},8,["title","rows","columns","style","filter","filter-method"]))}var le=V(x,[["render",te]]);const oe=F({name:"karaoke-list",components:{"radio-list-table":le},setup(){return{pageHeight:i(document.documentElement.scrollHeight*.85)}}});function se(e,t,d,m,u,c){const a=H("radio-list-table");return s(),b(L,{class:""},{default:r(()=>[p(a,{height:e.pageHeight},null,8,["height"])]),_:1})}var Ce=V(oe,[["render",se]]);export{Ce as default};
