import{j as d,p as f,G as F,Y as ue,i as le,r as _,k as $,l as re,T as I,s as ce,q as de,as as fe}from"./index.14a7c722.js";import{u as me,a as ge,b as he,c as ve,d as ye,e as xe}from"./use-prevent-scroll.49273e16.js";import{u as be,a as pe,b as qe,c as we}from"./use-tick.7b8fea28.js";import{b as ke}from"./focus-manager.02955f48.js";const Oe={name:String};function Re(e={}){return(i,n,g)=>{i[n](f("input",{class:"hidden"+(g||""),...e.value}))}}function $e(e){return d(()=>e.name||e.for)}const Ce=/[\u3000-\u303f\u3040-\u309f\u30a0-\u30ff\uff00-\uff9f\u4e00-\u9faf\u3400-\u4dbf]/,Be=/[\u4e00-\u9fff\u3400-\u4dbf\u{20000}-\u{2a6df}\u{2a700}-\u{2b73f}\u{2b740}-\u{2b81f}\u{2b820}-\u{2ceaf}\uf900-\ufaff\u3300-\u33ff\ufe30-\ufe4f\uf900-\ufaff\u{2f800}-\u{2fa1f}]/u,Ee=/[\u3131-\u314e\u314f-\u3163\uac00-\ud7a3]/,Te=/[a-z0-9_ -]$/i;function Ie(e){return function(n){if(n.type==="compositionend"||n.type==="change"){if(n.target.qComposing!==!0)return;n.target.qComposing=!1,e(n)}else n.type==="compositionupdate"&&n.target.qComposing!==!0&&typeof n.data=="string"&&(F.is.firefox===!0?Te.test(n.data)===!1:Ce.test(n.data)===!0||Be.test(n.data)===!0||Ee.test(n.data)===!0)===!0&&(n.target.qComposing=!0)}}const l=[];let m;function Se(e){m=e.keyCode===27}function _e(){m===!0&&(m=!1)}function Fe(e){m===!0&&(m=!1,ue(e,27)===!0&&l[l.length-1](e))}function V(e){window[e]("keydown",Se),window[e]("blur",_e),window[e]("keyup",Fe),m=!1}function ze(e){F.is.desktop===!0&&(l.push(e),l.length===1&&V("addEventListener"))}function j(e){const i=l.indexOf(e);i>-1&&(l.splice(i,1),l.length===0&&V("removeEventListener"))}const r=[];function W(e){r[r.length-1](e)}function De(e){F.is.desktop===!0&&(r.push(e),r.length===1&&document.body.addEventListener("focusin",W))}function A(e){const i=r.indexOf(e);i>-1&&(r.splice(i,1),r.length===0&&document.body.removeEventListener("focusin",W))}let p=0;const Pe={standard:"fixed-full flex-center",top:"fixed-top justify-center",bottom:"fixed-bottom justify-center",right:"fixed-right items-center",left:"fixed-left items-center"},Q={standard:["scale","scale"],top:["slide-down","slide-up"],bottom:["slide-up","slide-down"],right:["slide-left","slide-right"],left:["slide-right","slide-left"]};var je=le({name:"QDialog",inheritAttrs:!1,props:{...me,...be,transitionShow:String,transitionHide:String,persistent:Boolean,autoClose:Boolean,allowFocusOutside:Boolean,noEscDismiss:Boolean,noBackdropDismiss:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,noShake:Boolean,seamless:Boolean,maximized:Boolean,fullWidth:Boolean,fullHeight:Boolean,square:Boolean,position:{type:String,default:"standard",validator:e=>e==="standard"||["top","bottom","left","right"].includes(e)}},emits:[...ge,"shake","click","escapeKey"],setup(e,{slots:i,emit:n,attrs:g}){const q=de(),s=_(null),c=_(!1),h=_(!1);let a=null,u=null,y,w;const z=d(()=>e.persistent!==!0&&e.noRouteDismiss!==!0&&e.seamless!==!0),{preventBodyScroll:D}=xe(),{registerTimeout:P}=he(),{registerTick:G,removeTick:H}=pe(),{transitionProps:J,transitionStyle:K}=qe(e,()=>Q[e.position][0],()=>Q[e.position][1]),{showPortal:L,hidePortal:M,portalIsAccessible:N,renderPortal:U}=we(q,s,ae,"dialog"),{hide:x}=ve({showing:c,hideOnRouteChange:z,handleShow:ne,handleHide:oe,processOnMount:!0}),{addToHistory:Y,removeFromHistory:X}=ye(c,x,z),Z=d(()=>`q-dialog__inner flex no-pointer-events q-dialog__inner--${e.maximized===!0?"maximized":"minimized"} q-dialog__inner--${e.position} ${Pe[e.position]}`+(h.value===!0?" q-dialog__inner--animating":"")+(e.fullWidth===!0?" q-dialog__inner--fullwidth":"")+(e.fullHeight===!0?" q-dialog__inner--fullheight":"")+(e.square===!0?" q-dialog__inner--square":"")),b=d(()=>c.value===!0&&e.seamless!==!0),ee=d(()=>e.autoClose===!0?{onClick:ie}:{}),te=d(()=>[`q-dialog fullscreen no-pointer-events q-dialog--${b.value===!0?"modal":"seamless"}`,g.class]);$(()=>e.maximized,t=>{c.value===!0&&B(t)}),$(b,t=>{D(t),t===!0?(De(E),ze(C)):(A(E),j(C))});function ne(t){Y(),u=e.noRefocus===!1&&document.activeElement!==null?document.activeElement:null,B(e.maximized),L(),h.value=!0,e.noFocus!==!0?(document.activeElement!==null&&document.activeElement.blur(),G(v)):H(),P(()=>{if(q.proxy.$q.platform.is.ios===!0){if(e.seamless!==!0&&document.activeElement){const{top:o,bottom:T}=document.activeElement.getBoundingClientRect(),{innerHeight:R}=window,S=window.visualViewport!==void 0?window.visualViewport.height:R;o>0&&T>S/2&&(document.scrollingElement.scrollTop=Math.min(document.scrollingElement.scrollHeight-S,T>=R?1/0:Math.ceil(document.scrollingElement.scrollTop+T-S/2))),document.activeElement.scrollIntoView()}w=!0,s.value.click(),w=!1}L(!0),h.value=!1,n("show",t)},e.transitionDuration)}function oe(t){H(),X(),O(!0),h.value=!0,M(),u!==null&&(((t&&t.type.indexOf("key")===0?u.closest('[tabindex]:not([tabindex^="-"])'):void 0)||u).focus(),u=null),P(()=>{M(!0),h.value=!1,n("hide",t)},e.transitionDuration)}function v(t){ke(()=>{let o=s.value;o===null||o.contains(document.activeElement)===!0||(o=(t!==""?o.querySelector(t):null)||o.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||o.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||o.querySelector("[autofocus], [data-autofocus]")||o,o.focus({preventScroll:!0}))})}function k(t){t&&typeof t.focus=="function"?t.focus({preventScroll:!0}):v(),n("shake");const o=s.value;o!==null&&(o.classList.remove("q-animate--scale"),o.classList.add("q-animate--scale"),a!==null&&clearTimeout(a),a=setTimeout(()=>{a=null,s.value!==null&&(o.classList.remove("q-animate--scale"),v())},170))}function C(){e.seamless!==!0&&(e.persistent===!0||e.noEscDismiss===!0?e.maximized!==!0&&e.noShake!==!0&&k():(n("escapeKey"),x()))}function O(t){a!==null&&(clearTimeout(a),a=null),(t===!0||c.value===!0)&&(B(!1),e.seamless!==!0&&(D(!1),A(E),j(C))),t!==!0&&(u=null)}function B(t){t===!0?y!==!0&&(p<1&&document.body.classList.add("q-body--dialog"),p++,y=!0):y===!0&&(p<2&&document.body.classList.remove("q-body--dialog"),p--,y=!1)}function ie(t){w!==!0&&(x(t),n("click",t))}function se(t){e.persistent!==!0&&e.noBackdropDismiss!==!0?x(t):e.noShake!==!0&&k()}function E(t){e.allowFocusOutside!==!0&&N.value===!0&&fe(s.value,t.target)!==!0&&v('[tabindex]:not([tabindex="-1"])')}Object.assign(q.proxy,{focus:v,shake:k,__updateRefocusTarget(t){u=t||null}}),re(O);function ae(){return f("div",{role:"dialog","aria-modal":b.value===!0?"true":"false",...g,class:te.value},[f(I,{name:"q-transition--fade",appear:!0},()=>b.value===!0?f("div",{class:"q-dialog__backdrop fixed-full",style:K.value,"aria-hidden":"true",tabindex:-1,onClick:se}):null),f(I,J.value,()=>c.value===!0?f("div",{ref:s,class:Z.value,style:K.value,tabindex:-1,...ee.value},ce(i.default)):null)])}return U}});export{je as Q,$e as a,Ie as b,De as c,j as d,ze as e,Re as f,A as r,Oe as u};
