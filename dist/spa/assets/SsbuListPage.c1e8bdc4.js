import{j,i as J,p as Q,r as v,_ as K,d as O,a as W,o as c,c as D,w as h,e as d,aa as b,b as f,ae as V,ab as w,ac as X,ad as E,f as L,ag as U,af as $,Q as Z,g as x}from"./index.14a7c722.js";import{u as ee,Q as te}from"./use-quasar.7a6bd282.js";import{Q as I}from"./QSelect.c55664e6.js";import{Q as T,a as q,b as P,c as ae}from"./QTable.8542a644.js";import{Q as le}from"./QPage.82e76fcb.js";import{A as se,d as re}from"./BaseApi.ab9ec937.js";import{N as ue,S as oe}from"./SsbuNameSelect.4d0a056a.js";import"./QDialog.946db96e.js";import"./use-prevent-scroll.49273e16.js";import"./use-tick.7b8fea28.js";import"./focus-manager.02955f48.js";import"./QField.3dd07fc9.js";import"./QChip.15935488.js";import"./use-dark.7ce8ffd6.js";import"./QItem.0cb08ef4.js";import"./QItemLabel.d7165eea.js";import"./position-engine.ef89f240.js";import"./format.2a3572e1.js";import"./QSeparator.2e92d9dc.js";import"./QList.0b3bac39.js";import"./QCheckbox.9468544f.js";import"./use-checkbox.812d2cd3.js";const ie={ratio:[String,Number]};function ne(e,s){return j(()=>{const n=Number(e.ratio||(s!==void 0?s.value:void 0));return isNaN(n)!==!0&&n>0?{paddingBottom:`${100/n}%`}:null})}var de=J({name:"QVideo",props:{...ie,src:{type:String,required:!0},title:String,fetchpriority:{type:String,default:"auto"},loading:{type:String,default:"eager"},referrerpolicy:{type:String,default:"strict-origin-when-cross-origin"}},setup(e){const s=ne(e),n=j(()=>"q-video"+(e.ratio!==void 0?" q-video--responsive":""));return()=>Q("div",{class:n.value,style:s.value},[Q("iframe",{src:e.src,title:e.title,fetchpriority:e.fetchpriority,loading:e.loading,referrerpolicy:e.referrerpolicy,frameborder:"0",allowfullscreen:!0})])}});class ce extends se{search(){const s="/ssbu/search",n=this.combineUrl(s);return this.httpGet(n)}async download(s){const n=`/ssbu/download?id=${s}`,y=this.combineUrl(n);await re({url:y,method:"GET",responseType:"blob"}).then(m=>{if(m)return console.log("download",m),m})}}const M=new ce;function pe(){const{names:e,ssbuNames:s,searchName:n,getSsbuNames:y}=me(),m=ee(),F=v(-1),u=v({charName:"",title:"",date:"",folder:""}),a=v(["\u30A6\u30EB\u30C8\u30E9C","\u601D\u3044\u51FA","\u30A6\u30EB\u30C4\u30E9C","\u713C\u304D\u76F4\u3057","\u713C\u304D\u76F4\u3057\u30D5\u30A7\u30CB\u30C3\u30AF\u30B9","\u5927\u6C5F\u6238\u6E29\u6CC9\u7269\u8A9E","\u7D20\u6750"]),r=v(!1),N=function(l){var o,i;r.value=!0,g.value.search=!0;let t=l;return u.value.charName!=""&&u.value.charName!=null&&(t=t.filter(p=>p.charName==u.value.charName)),u.value.title!=""&&(t=t.filter(p=>p.fileName.includes(u.value.title))),((o=u.value.date)!=null?o:0>0)&&(t=t.filter(p=>{var _,k;return p.date.includes((k=(_=u.value.date)==null?void 0:_.replaceAll("/",""))!=null?k:"")})),((i=u.value.folder)!=null?i:0>0)&&(t=t.filter(p=>p.fileName.includes(u.value.folder))),r.value=!1,g.value.search=!1,t},A=[{name:"charName",label:"\u30AD\u30E3\u30E9\u540D",field:"charName",sortable:!0},{name:"fileName",label:"\u30BF\u30A4\u30C8\u30EB",field:"fileName",sortable:!0},{name:"displayDate",label:"\u65E5\u4ED8",field:"displayDate",sortable:!0}],g=v({search:!1,download:!1}),C=v([]),B=v([]),G=function(l){return l.includes("_")?l.split("_")[0]:""},R=function(l){if(l.includes("_")){const t=l.split("_");return t.length==2?t[1]:l}else return l};function z(l){if(l&&l.length===8){const t=l.slice(0,4),o=l.slice(4,6),i=l.slice(6,8);return`${t}/${o}/${i}`}return l}function Y(l,t,o){const i=new Date(l,t,o);return i.getFullYear()===l&&i.getMonth()===t&&i.getDate()===o}function S(l){const t=l.split("/");if(t.length===3){const o=parseInt(t[0],10),i=parseInt(t[1],10)-1,p=parseInt(t[2],10);if(Y(o,i,p))return new Date(o,i,p)}return null}function H(l,t){const o=S(l.displayDate),i=S(t.displayDate);return o==null||i==null?0:o<i?-1:o>i?1:0}return{filter:u,filteringData:N,disableFilter:r,selectId:F,columns:A,load:g,records:C,dateList:B,ssbuNames:s,folderList:a,search:async function(){g.value.search=!0,r.value=!0,await n(),await M.search().then(l=>{l&&(console.log("search",l),C.value.splice(0),l.records.forEach(t=>{const o=z(t.date.replaceAll("_",""));let i=R(t.fileName),p="";const _=G(t.fileName);e.value.forEach(k=>{k.key==_&&(p=k.val)}),_==""&&(i=t.fileName),C.value.push({id:t.id,charName:p,fileName:t.fileName,displayFileName:i,date:t.date,displayDate:o,year:t.year}),B.value.includes(o)||B.value.push(o)}),B.value.sort(),B.value.reverse(),C.value.sort(H),C.value.reverse())}).catch(l=>{console.log(l),m.notify({color:"red",position:"top",message:"\u30C7\u30FC\u30BF\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F"})}),r.value=!1,g.value.search=!1},getSsbuNames:y}}function me(){const e=new ue,s=v([]),n=async function(){s.value.splice(0),await e.search({key:"",val:""}).then(u=>{u&&(console.log("name",u),u.records.forEach(a=>{var r,N;return s.value.push({key:(r=a.key)!=null?r:"",val:(N=a.val)!=null?N:""})}))})},y=function(u){return s.value.forEach(a=>{if(u==a.key)return a.val}),""},m=v([]);return{names:s,searchName:n,getSsbuNames:async function(){m.value.splice(0),await e.ssbu_names().then(u=>{u&&u.records.forEach(a=>m.value.push(a.name))})},ssbuNames:m,getName:y}}const fe=O({name:"ssbu-list",components:{"ssbu-name-select":oe},setup(){const{filter:e,filteringData:s,disableFilter:n,folderList:y,selectId:m,columns:F,load:u,records:a,dateList:r,ssbuNames:N,search:A,getSsbuNames:g}=pe();return g(),A(),{filter:e,filteringData:s,disableFilter:n,folderList:y,selectId:m,columns:F,load:u,records:a,dateList:r,ssbuNames:N,search:A,api:M,playUrl:v(""),playName:v("")}}}),he=d("div",{class:"q-pb-md text-h5"},"\u30B9\u30DE\u30D6\u30E9\u5207\u308A\u629C\u304D\u96C6",-1),ve={class:"ssbu-container"},be={class:"ssbu-left-content"},ye={key:0},ge={class:"row q-gutter-xs text-primary"},we={key:1},Ne=d("div",{class:"video-container"},[d("div",{class:"video-placeholder"},[d("i",{class:"play-icon"},"\u25B6\uFE0F"),d("div",{class:"text-white"},"\u52D5\u753B\u306F\u3053\u3053\u3067\u518D\u751F\u3055\u308C\u308B\u3088")])],-1),De=[Ne],Ee={class:"ssbu-list-table"},Fe={class:"row q-gutter-md",style:{width:"830px"}},Ce={key:3,class:"text-caption"},Be={key:0,style:{width:"50px"}},_e={key:1,style:{width:"150px"}},ke={key:2,style:{width:"400px"}},Ae={key:3,style:{width:"50px"}};function Ve(e,s,n,y,m,F){const u=W("ssbu-name-select");return c(),D(le,{class:""},{default:h(()=>[he,d("div",ve,[d("div",be,[e.playUrl!=""?(c(),b("div",ye,[f(de,{src:e.playUrl,style:{width:"569px",height:"320px"}},null,8,["src"]),d("div",ge,[d("div",null,[f(V,{name:"music_note",color:"primary"})]),d("div",null,w(e.playName),1)])])):(c(),b("div",we,De))]),d("div",Ee,[f(ae,{rows:e.records,columns:e.columns,"row-id":"id",separator:"cell","rows-per-page-label":"\u8868\u793A\u884C\u6570","no-results-label":"\u898B\u3064\u304B\u3089\u306A\u304B\u3063\u305F...","no-data-label":"\u898B\u3064\u304B\u3089\u306A\u304B\u3063\u305F...",pagination:{rowsPerPage:0},"rows-per-page-options":[0],filter:e.filter,"filter-method":e.filteringData,style:{width:"830px"},class:"ssbu-table-scrollable-container"},{"top-left":h(()=>[d("div",Fe,[d("div",null,[f(te,{dense:"",debounce:"300",modelValue:e.filter.title,"onUpdate:modelValue":s[1]||(s[1]=a=>e.filter.title=a),placeholder:"\u691C\u7D22",style:{width:"200px"},align:"left",readonly:e.disableFilter},{append:h(()=>[e.load.search?(c(),D(X,{key:0,modelValue:e.load.search,"onUpdate:modelValue":s[0]||(s[0]=a=>e.load.search=a),color:"primary",size:"md"},null,8,["modelValue"])):E("",!0),e.filter.title.length==0?(c(),D(V,{key:1,name:"search"})):(c(),D(V,{key:2,name:"search",color:"primary"})),e.records.length>0?(c(),b("div",Ce,w(e.records.length),1)):E("",!0)]),_:1},8,["modelValue","readonly"])]),d("div",null,[f(u,{modelValue:e.filter.charName,"onUpdate:modelValue":s[2]||(s[2]=a=>e.filter.charName=a),readonly:e.disableFilter},null,8,["modelValue","readonly"])]),d("div",null,[f(I,{modelValue:e.filter.date,"onUpdate:modelValue":s[3]||(s[3]=a=>e.filter.date=a),options:e.dateList,dense:"","stack-label":"",clearable:"",label:"\u65E5\u4ED8","transition-show":"jump-up","transition-hide":"jump-up",style:{width:"130px"},readonly:e.disableFilter},null,8,["modelValue","options","readonly"])]),d("div",null,[f(I,{modelValue:e.filter.folder,"onUpdate:modelValue":s[4]||(s[4]=a=>e.filter.folder=a),options:e.folderList,dense:"","stack-label":"",clearable:"",label:"\u7A2E\u985E","transition-show":"jump-up","transition-hide":"jump-up",style:{width:"130px"},readonly:e.disableFilter},null,8,["modelValue","options","readonly"])])])]),header:h(a=>[f(T,{props:a},{default:h(()=>[f(q,null,{default:h(()=>[L("\u518D\u751F")]),_:1}),(c(!0),b($,null,U(a.cols,r=>(c(),D(q,{key:r.name,props:a},{default:h(()=>[r.label=="\u518D\u751F"?(c(),b("div",Be,w(r.label),1)):E("",!0),r.label=="\u30AD\u30E3\u30E9\u540D"?(c(),b("div",_e,w(r.label),1)):E("",!0),r.label=="\u30BF\u30A4\u30C8\u30EB"?(c(),b("div",ke,w(r.label),1)):E("",!0),r.label=="\u65E5\u4ED8"?(c(),b("div",Ae,w(r.label),1)):E("",!0)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:h(a=>[f(T,{props:a},{default:h(()=>[f(P,null,{default:h(()=>[f(Z,{icon:"play_arrow",href:e.api.apiEndpoint()+"/ssbu/download?id="+a.row.id,onClick:x(r=>{console.log("play",a.row),e.playUrl=e.api.apiEndpoint()+"/ssbu/download?id="+a.row.id,e.playName=a.row.fileName},["prevent"])},null,8,["href","onClick"])]),_:2},1024),(c(!0),b($,null,U(a.cols,r=>(c(),D(P,{key:r.name,props:a,style:{"white-space":"normal","text-align":"left"}},{default:h(()=>[L(w(r.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter","filter-method"])])])]),_:1})}var et=K(fe,[["render",Ve]]);export{et as default};
