import{Q as T}from"./QPage.82e76fcb.js";import{r as s,d as L,_ as D,o as n,c as h,w as i,e as f,b as d,ac as U,ad as g,ae as v,aa as y,ab as k,f as b,ag as V,af as N,g as S,ah as _,a as q}from"./index.14a7c722.js";import{u as I,Q as H}from"./use-quasar.7a6bd282.js";import{Q}from"./QSelect.c55664e6.js";import{Q as K}from"./QField.3dd07fc9.js";import{a as B,Q as $,b as E,c as P}from"./QTable.8542a644.js";import{A as j,d as z}from"./BaseApi.ab9ec937.js";import"./QDialog.946db96e.js";import"./use-prevent-scroll.49273e16.js";import"./use-tick.7b8fea28.js";import"./focus-manager.02955f48.js";import"./QChip.15935488.js";import"./use-dark.7ce8ffd6.js";import"./QItem.0cb08ef4.js";import"./QItemLabel.d7165eea.js";import"./position-engine.ef89f240.js";import"./format.2a3572e1.js";import"./QSeparator.2e92d9dc.js";import"./QList.0b3bac39.js";import"./QCheckbox.9468544f.js";import"./use-checkbox.812d2cd3.js";class G extends j{search(){const t="/karaoke/search",m=this.combineUrl(t);return this.httpGet(m)}async download(t){const m=`/karaoke/download?id=${t}`,p=this.combineUrl(m);await z({url:p,method:"GET",responseType:"blob"}).then(r=>{if(r)return console.log("download",r),r})}}const F=new G;function M(){const e=I(),t=s(""),m=s(-1),p=[{name:"fileName",label:"\u30D5\u30A1\u30A4\u30EB\u540D",field:"fileName",sortable:!0},{name:"date",label:"\u65E5\u4ED8",field:"date",sortable:!0}],r=s({search:!1,download:!1}),c=s([]),a=s([]),o=s([]),A=function(u){if(u.includes("_")){const w=u.split("_");return w.length==2?w[1]:u}else return u};return{filter:t,columns:p,load:r,records:c,search:async function(){r.value.search=!0,await F.search().then(u=>{u&&(console.log("search",u),c.value.splice(0),u.records.map(l=>({...l,date:new Date(`${l.date.slice(0,4)}-${l.date.slice(4,6)}-${l.date.slice(6,8)}`)})).sort((l,C)=>C.date.getTime()-l.date.getTime()).map(l=>({...l,date:l.date.toISOString().slice(0,10)})).forEach(l=>{l.fileName=A(l.fileName),c.value.push(l),a.value.includes(l.date)||a.value.push(l.date),o.value.includes(l.fileName)||o.value.push(l.fileName)}),o.value.sort())}).catch(u=>{console.log(u),e.notify({color:"red",position:"top",message:"\u30C7\u30FC\u30BF\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F"})}),r.value.search=!1},selectId:m,dateList:a,musicList:o}}const O=L({name:"table-karaoke-list",props:{modelValue:{type:String,required:!0},label:{type:String,required:!1,default:"\u30AB\u30E9\u30AA\u30B1\u97F3\u697D\u5802"},height:{type:Number,required:!1,default:700}},setup(e){const{columns:t,load:m,records:p,search:r,selectId:c,dateList:a,musicList:o}=M();return r(),{condition:s(e.modelValue),tableName:s(e.label),tableHeight:s(e.height+"px"),columns:t,load:m,records:p,search:r,api:F,selectId:c,playUrl:s(""),playName:s(""),dateList:a,musicList:o}}}),J={class:"row q-gutter-md",style:{width:"700px"}},R={key:3,class:"text-caption"},W={key:0,class:"row q-gutter-md"},X=["src"],Y=["href","onClick"];function Z(e,t,m,p,r,c){return e.load.search?g("",!0):(n(),h(P,{key:0,title:e.tableName,rows:e.records,columns:e.columns,"row-key":"id",style:_({height:e.tableHeight}),separator:"cell","rows-per-page-label":"\u8868\u793A\u884C\u6570","no-results-label":"\u898B\u3064\u304B\u3089\u306A\u304B\u3063\u305F...","no-data-label":"\u898B\u3064\u304B\u3089\u306A\u304B\u3063\u305F...",pagination:{rowsPerPage:0},"rows-per-page-options":[0],filter:e.condition,class:"karaoke-list-table"},{"top-right":i(()=>[f("div",J,[f("div",null,[d(H,{dense:"",debounce:"300",modelValue:e.condition,"onUpdate:modelValue":t[1]||(t[1]=a=>e.condition=a),placeholder:"\u691C\u7D22",style:{width:"200px"},align:"left"},{append:i(()=>[e.load.search?(n(),h(U,{key:0,modelValue:e.load.search,"onUpdate:modelValue":t[0]||(t[0]=a=>e.load.search=a),color:"primary",size:"md"},null,8,["modelValue"])):g("",!0),e.condition.length==0?(n(),h(v,{key:1,name:"search"})):(n(),h(v,{key:2,name:"search",color:"primary"})),e.records.length>0?(n(),y("div",R,k(e.records.length),1)):g("",!0)]),_:1},8,["modelValue"])]),f("div",null,[d(Q,{modelValue:e.condition,"onUpdate:modelValue":t[2]||(t[2]=a=>e.condition=a),options:e.musicList,dense:"","stack-label":"",label:"\u66F2\u540D","transition-show":"jump-up","transition-hide":"jump-up",style:{width:"300px"}},null,8,["modelValue","options"])]),f("div",null,[d(Q,{modelValue:e.condition,"onUpdate:modelValue":t[3]||(t[3]=a=>e.condition=a),options:e.dateList,dense:"","stack-label":"",label:"\u65E5\u4ED8","transition-show":"jump-up","transition-hide":"jump-up",style:{width:"150px"}},null,8,["modelValue","options"])])]),e.playName!=""&&e.playUrl!=""?(n(),y("div",W,[f("audio",{controls:"",src:e.playUrl,autoplay:""},null,8,X),d(K,{borderless:"",class:"q-pt-md",style:{height:"18px"}},{default:i(()=>[b(k(e.playName),1)]),_:1})])):g("",!0)]),header:i(a=>[d($,{props:a},{default:i(()=>[d(B,null,{default:i(()=>[b("\u518D\u751F")]),_:1}),(n(!0),y(N,null,V(a.cols,o=>(n(),h(B,{key:o.name,props:a},{default:i(()=>[b(k(o.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:i(a=>[d($,{props:a},{default:i(()=>[d(E,null,{default:i(()=>[f("a",{href:e.api.apiEndpoint()+"/karaoke/download?id="+a.row.id,onClick:S(o=>{console.log("play",a.row),e.playUrl=e.api.apiEndpoint()+"/karaoke/download?id="+a.row.id,e.playName=a.row.fileName},["prevent"]),class:"play-btn"},[d(v,{name:"play_circle",color:"primary",size:"sm"})],8,Y)]),_:2},1024),(n(!0),y(N,null,V(a.cols,o=>(n(),h(E,{key:o.name,props:a,style:{"white-space":"normal","text-align":"left"}},{default:i(()=>[b(k(o.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),_:1},8,["title","rows","columns","style","filter"]))}var x=D(O,[["render",Z]]);const ee=L({name:"karaoke-list",components:{"karaoke-list-table":x},setup(){const e=s(document.documentElement.scrollHeight*.85);return{filter:s(""),pageHeight:e}}});function ae(e,t,m,p,r,c){const a=q("karaoke-list-table");return n(),h(T,{class:""},{default:i(()=>[d(a,{modelValue:e.filter,"onUpdate:modelValue":t[0]||(t[0]=o=>e.filter=o),height:e.pageHeight},null,8,["modelValue","height"])]),_:1})}var Qe=D(ee,[["render",ae]]);export{Qe as default};
